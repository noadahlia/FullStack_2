<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="css/game_display.css">


    <title>FullGames - Free online games</title>
</head>

<body>
    <ul class="icons">
        <li><div class="logout_btn">
             <img src="images/logout.png" width="40" height="40">
         </div></li> 
         <li><div class="home_btn">
             <img src="images/home.png" width="40" height="40" onclick="home()">
         </div></li>
     </ul>
    <div class="main-container">
        <h1 id="game_title" class="game_title" style="text-align: center;">
            <!-- Word Guessing -->
            <h1>
                <div class="wrapper">
                    <div class="scores column">
                        <h4 style="font-size: 18px;">Your Score:</h4>
                        <div id="score">0</div>
                        <h4 style="font-size: 18px;">Best Scores:</h4>
                        <table id="score_table" class="score_table">
                        </table>                    
                    </div>
                    <div class="embedded_game column">
                        <iframe id="game_frm"></iframe>
                    </div>
                </div>

    </div>
    <script>
        //var queryString = location.search.substring(1)+".html";
        //var url="games/"+queryString;
        let url = localStorage.getItem("url");
        document.getElementById('game_frm').src = url;
        let game = localStorage.getItem("game");
        let gameTitle = game.replace(/([A-Z])/g, ' $1').replace(/^./, function (str) { return str.toUpperCase(); })
        document.getElementById("game_title").textContent = gameTitle;
        document.getElementById('game_frm').focus();
        let table = document.getElementById("score_table");
        let cur_user=JSON.parse(localStorage.getItem("user"));



        function loadTable() {
            table.innerHTML = "";
            let users = JSON.parse(localStorage.getItem("users"));
            users.sort((a,b)=>{return b[game]-a[game]});
            users.forEach(element => {
                addRow(element);
            });

        }

        loadTable();


        function addRow(user) {


            let rowCount = table.rows.length;
            let row = table.insertRow(rowCount);
            let cell1 = row.insertCell(0);
            let username = user.userName;
            cell1.innerHTML = username;
            cell1.style.textAlign="left";
            let cell2 = row.insertCell(1);
            cell2.innerHTML = user[game];
            cell2.style.textAlign="right";

        }

        let scoreP = document.getElementById("score");
        let interval = setInterval(updateScore, 500);

        function updateScore() {
            let users = JSON.parse(localStorage.getItem("users"));

            let currentScore = localStorage.getItem("score");
            scoreP.innerHTML = currentScore;

            users.forEach(u => {
                if(u.userName==cur_user.userName){
                    if(currentScore>u[game]){
                        u[game]=currentScore;
                        localStorage.setItem("users",JSON.stringify(users));
                        loadTable();
                    }
                }
            });
        }

    </script>

    <script src="js/icons_click.js"></script>
</body>

</html>